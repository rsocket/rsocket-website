<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="RSocket Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="RSocket Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122364851-2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-122364851-2",{})</script>
<link rel="stylesheet" href="https://docusaurus.io/style.css">
<link rel="stylesheet" href="http://css.link">
<script src="https://docusaurus.io/slash.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js" async></script><title data-react-helmet="true">Protocol | RSocket</title><meta data-react-helmet="true" property="og:image" content="https://rsocket.io/img/r-rsocket-pink.png"><meta data-react-helmet="true" name="twitter:image" content="https://rsocket.io/img/r-rsocket-pink.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for RSocket"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Protocol | RSocket"><meta data-react-helmet="true" name="description" content="Status"><meta data-react-helmet="true" property="og:description" content="Status"><meta data-react-helmet="true" property="og:url" content="https://rsocket.io/docs/protocol"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://rsocket.io/docs/protocol"><link rel="stylesheet" href="/styles.2e0ca1d0.css">
<link rel="preload" href="/styles.02122034.js" as="script">
<link rel="preload" href="/runtime~main.3253e25a.js" as="script">
<link rel="preload" href="/main.09032be5.js" as="script">
<link rel="preload" href="/common.cba57560.js" as="script">
<link rel="preload" href="/18.42db9e10.js" as="script">
<link rel="preload" href="/19.2da7a886.js" as="script">
<link rel="preload" href="/935f2afb.50f36023.js" as="script">
<link rel="preload" href="/17896441.7503419a.js" as="script">
<link rel="preload" href="/496dd638.57ae22a7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/r-socket-pink.svg" alt="RSocket" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/r-socket-pink.svg" alt="RSocket" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">RSocket</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">About</a><a href="https://github.com/rsocket" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/help">Help</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/r-socket-pink.svg" alt="RSocket" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/r-socket-pink.svg" alt="RSocket" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">RSocket</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">About</a></li><li class="menu__list-item"><a href="https://github.com/rsocket" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/help">Help</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/">FAQ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/motivations">Motivations</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/protocol">Protocol</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/implementations">Implementations</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Protocol</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="status"></a>Status<a class="hash-link" href="#status" title="Direct link to heading">#</a></h2><p>This protocol is currently a draft for the final specifications.
Current version of the protocol is <strong>0.2</strong> (Major Version: 0, Minor Version: 2). This is currently considered a 1.0 Release Candidate. Final testing is being done in Java and C++ implementations with goal to release 1.0 in the near future.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Specify an application protocol for <a href="http://www.reactive-streams.org" target="_blank" rel="noopener noreferrer" title="Reactive Streams is an initiative to provide a standard for asynchronous stream processing with non-blocking back pressure.">Reactive Streams</a> semantics across an asynchronous, binary
boundary. For more information, please see <a href="http://rsocket.io/" target="_blank" rel="noopener noreferrer">rsocket.io</a>.</p><p>RSocket assumes an operating paradigm. These assumptions are:</p><ul><li><p>one-to-one communication</p></li><li><p>non-proxied communication. Or if proxied, the RSocket semantics and assumptions are preserved across the proxy.</p></li><li><p>no state preserved across <a href="#transport-protocol">transport protocol</a> sessions by the protocol</p></li></ul><p>Key words used by this document conform to the meanings in <a href="https://tools.ietf.org/html/rfc2119" target="_blank" rel="noopener noreferrer" title="Key words for use in RFCs to Indicate Requirement Levels">RFC 2119</a>.</p><p>Byte ordering is big endian for all fields.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="table-of-contents"></a>Table of Contents<a class="hash-link" href="#table-of-contents" title="Direct link to heading">#</a></h2><ul><li><a href="#terminology">Terminology</a></li><li><a href="#versioning-scheme">Versioning Scheme</a></li><li><a href="#data-and-metadata">Data and Metadata</a></li><li><a href="#framing">Framing</a><ul><li><a href="#transport-protocol">Transport Protocol</a></li><li><a href="#framing-protocol-usage">Framing Protocol Usage</a></li><li><a href="#framing-format">Framing Format</a></li><li><a href="#frame-header-format">Frame Header Format</a></li><li><a href="#stream-identifiers">Stream Identifiers</a></li><li><a href="#frame-types">Frame Types</a></li></ul></li><li><a href="#resuming-operation">Resuming Operation</a></li><li><a href="#connection-establishment">Connection Establishment</a></li><li><a href="#fragmentation-and-reassembly">Fragmentation and Reassembly</a></li><li><a href="#stream-sequences-and-lifetimes">Stream Sequences and Lifetimes</a><ul><li><a href="#stream-sequences-request-response">Request Response</a></li><li><a href="#stream-sequences-fire-and-forget">Fire and Forget</a></li><li><a href="#stream-sequences-request-stream">Request Stream</a></li><li><a href="#stream-sequences-channel">Request Channel</a></li></ul></li><li><a href="#flow-control">Flow Control</a><ul><li><a href="#flow-control-reactive-streams">Reactive Stream Semantics</a></li><li><a href="#flow-control-lease">Lease Semantics</a></li><li><a href="#flow-control-qos">QoS and Prioritization</a></li></ul></li><li><a href="#handling-the-unexpected">Handling the Unexpected</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="terminology"></a>Terminology<a class="hash-link" href="#terminology" title="Direct link to heading">#</a></h2><ul><li><strong>Frame</strong>: A single message containing a request, response, or protocol processing.</li><li><strong>Fragment</strong>: A portion of an application message that has been partitioned for inclusion in a Frame.
See <a href="#fragmentation-and-reassembly">Fragmentation and Reassembly</a>.</li><li><strong>Transport</strong>: Protocol used to carry RSocket protocol. One of WebSockets, TCP, or <a href="https://github.com/real-logic/Aeron" target="_blank" rel="noopener noreferrer" title="Efficient reliable UDP unicast, UDP multicast, and IPC message transport.">Aeron</a>. The transport MUST
provide capabilities mentioned in the <a href="#transport-protocol">transport protocol</a> section.</li><li><strong>Stream</strong>: Unit of operation (request/response, etc.). See <a href="/docs/motivations">Motivations</a>.</li><li><strong>Request</strong>: A stream request. May be one of four types. As well as request for more items or cancellation of previous request.</li><li><strong>Payload</strong>: A stream message (upstream or downstream). Contains data associated with a stream created by a previous request. In <a href="http://www.reactive-streams.org" target="_blank" rel="noopener noreferrer" title="Reactive Streams is an initiative to provide a standard for asynchronous stream processing with non-blocking back pressure.">Reactive Streams</a> and Rx this is the &#x27;onNext&#x27; event.</li><li><strong>Complete</strong>: Terminal event sent on a stream to signal successful completion. In Reactive Streams and Rx this is the &#x27;onComplete&#x27; event.<ul><li>A frame (PAYLOAD or REQUEST_CHANNEL) with the Complete bit set is sometimes referred to as COMPLETE in this document when reference to the frame is semantically about the Complete bit/event.</li></ul></li><li><strong>Client</strong>: The side initiating a connection.</li><li><strong>Server</strong>: The side accepting connections from clients.</li><li><strong>Connection</strong>: The instance of a transport session between client and server.</li><li><strong>Requester</strong>: The side sending a request. A connection has at most 2 Requesters. One in each direction.</li><li><strong>Responder</strong>: The side receiving a request. A connection has at most 2 Responders. One in each direction.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="versioning-scheme"></a>Versioning Scheme<a class="hash-link" href="#versioning-scheme" title="Direct link to heading">#</a></h2><p>RSocket follows a versioning scheme consisting of a numeric major version and a numeric minor version.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cross-version-compatibility"></a>Cross version compatibility<a class="hash-link" href="#cross-version-compatibility" title="Direct link to heading">#</a></h3><p>RSocket assumes that all version changes (major and minor) are backward incompatible.
A client can pass a version that it supports via the <a href="#frame-setup">Setup Frame</a>.
It is up to a server to accept clients of lower versions than what it supports.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="data-and-metadata"></a>Data And Metadata<a class="hash-link" href="#data-and-metadata" title="Direct link to heading">#</a></h2><p>RSocket provides mechanisms for applications to distinguish payload into two types. Data and Metadata. The distinction
between the types in an application is left to the application.</p><p>The following are features of Data and Metadata.</p><ul><li>Metadata can be encoded differently than Data.</li><li>Metadata can be &quot;attached&quot; (i.e. correlated) with the following entities:</li><li>Connection via Metadata Push and Stream ID of 0</li><li>Individual Request or Payload (upstream or downstream)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="framing"></a>Framing<a class="hash-link" href="#framing" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="transport-protocol"></a>Transport Protocol<a class="hash-link" href="#transport-protocol" title="Direct link to heading">#</a></h3><p>The RSocket protocol uses a lower level transport protocol to carry RSocket frames. A transport protocol MUST provide the following:</p><ol><li>Unicast <a href="https://en.wikipedia.org/wiki/Reliability_(computer_networking)" target="_blank" rel="noopener noreferrer">Reliable Delivery</a>.</li><li><a href="https://en.wikipedia.org/wiki/Connection-oriented_communication" target="_blank" rel="noopener noreferrer">Connection-Oriented</a> and preservation of frame ordering. Frame A sent before Frame B MUST arrive in source order. i.e. if Frame A is sent by the same source as Frame B, then Frame A will always arrive before Frame B. No assumptions about ordering across sources is assumed.</li><li><a href="https://en.wikipedia.org/wiki/Frame_check_sequence" target="_blank" rel="noopener noreferrer">FCS</a> is assumed to be in use either at the transport protocol or at each MAC layer hop. But no protection against malicious corruption is assumed.</li></ol><p>An implementation MAY &quot;close&quot; a transport connection due to protocol processing. When this occurs, it is assumed that the connection will have no further frames sent and all frames will be ignored.</p><p>RSocket as specified here has been designed for and tested with TCP, WebSocket, <a href="https://github.com/real-logic/Aeron" target="_blank" rel="noopener noreferrer" title="Efficient reliable UDP unicast, UDP multicast, and IPC message transport.">Aeron</a>, and <a href="https://http2.github.io/http2-spec/#StreamsLayer" target="_blank" rel="noopener noreferrer">HTTP/2 streams</a> as transport protocols.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="framing-protocol-usage"></a>Framing Protocol Usage<a class="hash-link" href="#framing-protocol-usage" title="Direct link to heading">#</a></h3><p>Some of the supported transport protocols for RSocket may not support specific framing that preserves message boundaries. For these protocols, a framing protocol MUST be used with the RSocket frame that prepends the RSocket Frame Length.</p><p>The frame length field MUST be omitted if the transport protocol preserves message boundaries e.g. provides compatible framing. If, however, the transport protocol only provides a stream abstraction or can merge messages without preserving boundaries, or multiple transport protocols may be used, then the frame header MUST be used.</p><table><thead><tr><th align="left">Transport Protocol</th><th align="left">Frame Length Field Required</th></tr></thead><tbody><tr><td align="left">TCP</td><td align="left"><strong>YES</strong></td></tr><tr><td align="left">WebSocket</td><td align="left"><strong>NO</strong></td></tr><tr><td align="left">Aeron</td><td align="left"><strong>NO</strong></td></tr><tr><td align="left">HTTP/2 Stream</td><td align="left"><strong>YES</strong></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="framing-format"></a>Framing Format<a class="hash-link" href="#framing-format" title="Direct link to heading">#</a></h3><p>When using a transport protocol providing framing, the RSocket frame is simply encapsulated into the transport protocol messages directly.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                RSocket Frame          ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When using a transport protocol that does not provide compatible framing, the Frame Length MUST be prepended to the RSocket Frame.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                    Frame Length               |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                RSocket Frame          ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Length</strong>: (24 bits = max value 16,777,215) Unsigned 24-bit integer representing the length of Frame in bytes. Excluding the Frame Length field.</li></ul><p><strong>NOTE</strong>: Byte ordering is big endian.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="frame-header-format"></a>Frame Header Format<a class="hash-link" href="#frame-header-format" title="Direct link to heading">#</a></h3><p>RSocket frames begin with a RSocket Frame Header. The general layout is given below.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                         Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |I|M|     Flags     |     Depends on Frame Type    ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Stream ID</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer representing the stream Identifier for this frame or 0 to indicate the entire connection.<ul><li>Transport protocols that include demultiplexing, such as HTTP/2, MAY omit the Stream ID field if all parties agree. The means of negotiation and agreement is left to the transport protocol.</li></ul></li><li><strong>Frame Type</strong>: (6 bits = max value 63) Type of Frame.</li><li><strong>Flags</strong>: (10 bits) Any Flag bit not specifically indicated in the frame type should be set to 0 when sent and not interpreted on
reception. Flags generally depend on Frame Type, but all frame types MUST provide space for the following flags:
<em> (<strong>I</strong>)gnore: Ignore frame if not understood
</em> (<strong>M</strong>)etadata: Metadata present</li></ul><p><strong>NOTE</strong>: Byte ordering is big endian.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="handling-ignore-flag"></a>Handling Ignore Flag<a class="hash-link" href="#handling-ignore-flag" title="Direct link to heading">#</a></h4><p>The (<strong>I</strong>)gnore flag is used for extension of the protocol. A value of 0 in a frame for this flag indicates the protocol can&#x27;t
ignore this frame. An implementation MAY send an ERROR[CONNECTION_ERROR] frame and close the underlying transport
connection on reception of a frame that it does not understand with this bit not set.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="frame-validation"></a>Frame Validation<a class="hash-link" href="#frame-validation" title="Direct link to heading">#</a></h4><p>RSocket implementations may provide their own validation at the metadata level for specific frames. However, this is an application concern and not necessary for protocol processing.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="metadata-optional-header"></a>Metadata Optional Header<a class="hash-link" href="#metadata-optional-header" title="Direct link to heading">#</a></h4><p>Specific Frame Types MAY contain Metadata. If that Frame Type supports both Data and Metadata, the optional Metadata header MUST be included. This metadata header is between the Frame Header and any payload.</p><p>Metadata Length MUST be equal to the Frame Length minus the sum of the length of the Frame Header and the length of the Frame Payload, if present. If Metadata Length is not equal to this value, the frame is invalid and the receiver MUST send an ERROR[CONNECTION_ERROR] frame and close the underlying transport connection on reception unless the frame&#x27;s IGNORE flag is set.</p><p>On a frame with Data and Metadata:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|              Metadata Length                  |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                       Metadata Payload                       ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                       Payload of Frame                       ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>On a frame that supports Data and Metadata, but Data length is 0:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|              Metadata Length                  |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                       Metadata Payload                       ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>On a frame that only has Metadata, the Metadata length field is NOT needed:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                       Metadata Payload                       ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Metadata Length</strong>: (24 bits = max value 16,777,215) Unsigned 24-bit integer representing the length of Metadata in bytes. Excluding Metadata Length field.</li></ul><a name="stream-identifiers"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="stream-identifiers"></a>Stream Identifiers<a class="hash-link" href="#stream-identifiers" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="generation"></a>Generation<a class="hash-link" href="#generation" title="Direct link to heading">#</a></h4><p>Stream IDs are generated by a Requester. The lifetime of a Stream ID is determined by the request type and
the semantics of the stream based on its type.</p><p>Stream ID value of 0 is reserved for any operation involving the connection.</p><p>A Stream ID MUST be locally unique for a Requester in a connection.</p><p>Stream ID generation follows general guidelines for <a href="https://tools.ietf.org/html/rfc7540" target="_blank" rel="noopener noreferrer">HTTP/2</a> with respect
to odd/even values. In other words, a client MUST generate odd Stream IDs and a server MUST generate even Stream IDs.</p><p>Stream IDs on the client MUST start at 1 and increment by 2 sequentially, such as 1, 3, 5, 7, etc.</p><p>Stream IDs on the server MUST start at 2 and increment by 2 sequentially, such as 2, 4, 6, 8, etc.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lifetime"></a>Lifetime<a class="hash-link" href="#lifetime" title="Direct link to heading">#</a></h4><p>Once the max Stream ID has been used (2^31-1), the Requester MAY re-use Stream IDs. A Responder MUST assume Stream IDs will be re-used.</p><p>When the max Stream ID has been used:</p><ol><li>If Stream ID re-use is not employed:</li></ol><ul><li>No new streams can be created, thus a new connection MUST be established to create new streams once the max has been met.</li></ul><ol start="2"><li>If Stream IDs are re-used:</li></ol><ul><li>The Requester MUST re-use IDs by wrapping and restarting at ID 1 for client, and ID 2 for server, and incrementing sequentially by 2s as stated above.</li><li>The Requester MUST skip IDs still in use.</li><li>The Responder MAY choose to ERROR[REJECT] any Stream ID if it considers the ID still in use. The Requester MAY retry on the next sequential Stream ID considered unused.</li><li>If all Stream IDs are concurrently in use, no new streams can be created, thus a new connection MUST be established to create new streams.</li></ul><p>It is RECOMMENDED that Stream ID re-use only be used in combination with resumability.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="frame-types"></a>Frame Types<a class="hash-link" href="#frame-types" title="Direct link to heading">#</a></h3><table><thead><tr><th align="left">Type</th><th align="left">Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><strong>RESERVED</strong></td><td align="left">0x00</td><td align="left"><strong>Reserved</strong></td></tr><tr><td align="left"><a href="#frame-setup"><strong>SETUP</strong></a></td><td align="left">0x01</td><td align="left"><strong>Setup</strong>: Sent by client to initiate protocol processing.</td></tr><tr><td align="left"><a href="#frame-lease"><strong>LEASE</strong></a></td><td align="left">0x02</td><td align="left"><strong>Lease</strong>: Sent by Responder to grant the ability to send requests.</td></tr><tr><td align="left"><a href="#frame-keepalive"><strong>KEEPALIVE</strong></a></td><td align="left">0x03</td><td align="left"><strong>Keepalive</strong>: Connection keepalive.</td></tr><tr><td align="left"><a href="#frame-request-response"><strong>REQUEST_RESPONSE</strong></a></td><td align="left">0x04</td><td align="left"><strong>Request Response</strong>: Request single response.</td></tr><tr><td align="left"><a href="#frame-fnf"><strong>REQUEST_FNF</strong></a></td><td align="left">0x05</td><td align="left"><strong>Fire And Forget</strong>: A single one-way message.</td></tr><tr><td align="left"><a href="#frame-request-stream"><strong>REQUEST_STREAM</strong></a></td><td align="left">0x06</td><td align="left"><strong>Request Stream</strong>: Request a completable stream.</td></tr><tr><td align="left"><a href="#frame-request-channel"><strong>REQUEST_CHANNEL</strong></a></td><td align="left">0x07</td><td align="left"><strong>Request Channel</strong>: Request a completable stream in both directions.</td></tr><tr><td align="left"><a href="#frame-request-n"><strong>REQUEST_N</strong></a></td><td align="left">0x08</td><td align="left"><strong>Request N</strong>: Request N more items with <a href="http://www.reactive-streams.org" target="_blank" rel="noopener noreferrer" title="Reactive Streams is an initiative to provide a standard for asynchronous stream processing with non-blocking back pressure.">Reactive Streams</a> semantics.</td></tr><tr><td align="left"><a href="#frame-cancel"><strong>CANCEL</strong></a></td><td align="left">0x09</td><td align="left"><strong>Cancel Request</strong>: Cancel outstanding request.</td></tr><tr><td align="left"><a href="#frame-payload"><strong>PAYLOAD</strong></a></td><td align="left">0x0A</td><td align="left"><strong>Payload</strong>: Payload on a stream. For example, response to a request, or message on a channel.</td></tr><tr><td align="left"><a href="#frame-error"><strong>ERROR</strong></a></td><td align="left">0x0B</td><td align="left"><strong>Error</strong>: Error at connection or application level.</td></tr><tr><td align="left"><a href="#frame-metadata-push"><strong>METADATA_PUSH</strong></a></td><td align="left">0x0C</td><td align="left"><strong>Metadata</strong>: Asynchronous Metadata frame</td></tr><tr><td align="left"><a href="#frame-resume"><strong>RESUME</strong></a></td><td align="left">0x0D</td><td align="left"><strong>Resume</strong>: Replaces SETUP for Resuming Operation (optional)</td></tr><tr><td align="left"><a href="#frame-resume-ok"><strong>RESUME_OK</strong></a></td><td align="left">0x0E</td><td align="left"><strong>Resume OK</strong> : Sent in response to a RESUME if resuming operation possible (optional)</td></tr><tr><td align="left"><a href="#frame-ext"><strong>EXT</strong></a></td><td align="left">0x3F</td><td align="left"><strong>Extension Header</strong>: Used To Extend more frame types as well as extensions.</td></tr></tbody></table><a name="frame-setup"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="setup-frame-0x01"></a>SETUP Frame (0x01)<a class="hash-link" href="#setup-frame-0x01" title="Direct link to heading">#</a></h3><p>Setup frames MUST always use Stream ID 0 as they pertain to the connection.</p><p>The SETUP frame is sent by the client to inform the server of the parameters under which it desires
to operate. The usage and message sequence used is shown in <a href="#connection-establishment">Connection Establishment</a>.</p><p>One of the important parameters for a connection is the format, layout, and any schema of the data and metadata for
frames. This is, for lack of a better term, referred to here as &quot;MIME Type&quot;. An implementation MAY use typical MIME type
values or MAY decide to use specific non-MIME type values to indicate format, layout, and any schema
for data and metadata. The protocol implementation MUST NOT interpret the MIME type itself. This is an application
concern only.</p><p>The encoding format for Data and Metadata are included separately in the SETUP.</p><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                         Stream ID = 0                         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-+-----------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|R|L|  Flags    |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-+-----------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|         Major Version         |        Minor Version          |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                 Time Between KEEPALIVE Frames               |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                       Max Lifetime                          |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|         Token Length          | Resume Identification Token  ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------+-----------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|  MIME Length  |   Metadata Encoding MIME Type                ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------+-----------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|  MIME Length  |     Data Encoding MIME Type                  ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------+-----------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                      Metadata &amp; Setup Payload</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x01</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata present</li><li>(<strong>R</strong>)esume Enable: Client requests resume capability if possible. Resume Identification Token present.</li><li>(<strong>L</strong>)ease: Will honor LEASE (or not).</li></ul></li><li><strong>Major Version</strong>: (16 bits = max value 65,535) Unsigned 16-bit integer of Major version number of the protocol.</li><li><strong>Minor Version</strong>: (16 bits = max value 65,535) Unsigned 16-bit integer of Minor version number of the protocol.</li><li><strong>Time Between KEEPALIVE Frames</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer of Time (in milliseconds) between KEEPALIVE frames that the client will send. Value MUST be &gt; 0.<ul><li>For server-to-server connections, a reasonable time interval between client KEEPALIVE frames is 500ms.</li><li>For mobile-to-server connections, the time interval between client KEEPALIVE frames is often &gt; 30,000ms.</li></ul></li><li><strong>Max Lifetime</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer of Time (in milliseconds) that a client will allow a server to not respond to a KEEPALIVE before it is assumed to be dead. Value MUST be &gt; 0.</li><li><strong>Resume Identification Token Length</strong>: (16 bits = max value 65,535) Unsigned 16-bit integer of Resume Identification Token Length in bytes. (Not present if R flag is not set)</li><li><strong>Resume Identification Token</strong>: Token used for client resume identification (Not present if R flag is not set)</li><li><strong>MIME Length</strong>: Encoding MIME Type Length in bytes.</li><li><strong>Encoding MIME Type</strong>: MIME Type for encoding of Data and Metadata. This SHOULD be a US-ASCII string
that includes the <a href="https://en.wikipedia.org/wiki/Internet_media_type" target="_blank" rel="noopener noreferrer">Internet media type</a> specified
in <a href="https://tools.ietf.org/html/rfc2045" target="_blank" rel="noopener noreferrer" title="Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies">RFC 2045</a>. Many are registered with
<a href="https://www.iana.org/assignments/media-types/media-types.xhtml" target="_blank" rel="noopener noreferrer">IANA</a> such as
<a href="https://www.iana.org/assignments/media-types/application/cbor" target="_blank" rel="noopener noreferrer">CBOR</a>.
<a href="http://www.iana.org/assignments/media-type-structured-suffix/media-type-structured-suffix.xml" target="_blank" rel="noopener noreferrer">Suffix</a>
rules MAY be used for handling layout. For example, <code>application/x.netflix+cbor</code> or
<code>application/x.reactivesocket+cbor</code> or <code>application/x.netflix+json</code>. The string MUST NOT be null terminated.</li><li><strong>Setup Data</strong>: includes payload describing connection capabilities of the endpoint sending the
Setup header.</li></ul><p><strong>NOTE</strong>: A server that receives a SETUP frame that has (<strong>R</strong>)esume Enabled set, but does not support resuming operation, MUST reject the SETUP with an ERROR[REJECTED_SETUP].</p><a name="frame-error"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="error-frame-0x0b"></a>ERROR Frame (0x0B)<a class="hash-link" href="#error-frame-0x0b" title="Direct link to heading">#</a></h3><p>Error frames are used for errors on individual requests/streams as well as connection errors and in response to SETUP frames.</p><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|0|      Flags    |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                          Error Code                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                           Error Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x0B</li><li><strong>Error Code</strong>: (32 bits = max value 2^31-1 = 2,147,483,647) Type of Error.<ul><li>See list of valid Error Codes below.</li></ul></li><li><strong>Error Data</strong>: includes Payload describing error information. Error Data SHOULD be a UTF-8 encoded string. The string MUST NOT be null terminated.</li></ul><p>A Stream ID of 0 means the error pertains to the connection., including connection establishment. A Stream ID &gt; 0 means the error pertains to a given stream.</p><p>The Error Data is typically an Exception message, but could include stringified stacktrace information if appropriate.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="error-codes"></a>Error Codes<a class="hash-link" href="#error-codes" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Type</th><th align="left">Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><strong>RESERVED</strong></td><td align="left">0x00000000</td><td align="left"><strong>Reserved</strong></td></tr><tr><td align="left"><strong>INVALID_SETUP</strong></td><td align="left">0x00000001</td><td align="left">The Setup frame is invalid for the server (it could be that the client is too recent for the old server). Stream ID MUST be 0.</td></tr><tr><td align="left"><strong>UNSUPPORTED_SETUP</strong></td><td align="left">0x00000002</td><td align="left">Some (or all) of the parameters specified by the client are unsupported by the server. Stream ID MUST be 0.</td></tr><tr><td align="left"><strong>REJECTED_SETUP</strong></td><td align="left">0x00000003</td><td align="left">The server rejected the setup, it can specify the reason in the payload. Stream ID MUST be 0.</td></tr><tr><td align="left"><strong>REJECTED_RESUME</strong></td><td align="left">0x00000004</td><td align="left">The server rejected the resume, it can specify the reason in the payload. Stream ID MUST be 0.</td></tr><tr><td align="left"><strong>CONNECTION_ERROR</strong></td><td align="left">0x00000101</td><td align="left">The connection is being terminated. Stream ID MUST be 0. Sender or Receiver of this frame MAY close the connection immediately without waiting for outstanding streams to terminate.</td></tr><tr><td align="left"><strong>CONNECTION_CLOSE</strong></td><td align="left">0x00000102</td><td align="left">The connection is being terminated. Stream ID MUST be 0. Sender or Receiver of this frame MUST wait for outstanding streams to terminate before closing the connection. New requests MAY not be accepted.</td></tr><tr><td align="left"><strong>APPLICATION_ERROR</strong></td><td align="left">0x00000201</td><td align="left">Application layer logic generating a <a href="http://www.reactive-streams.org" target="_blank" rel="noopener noreferrer" title="Reactive Streams is an initiative to provide a standard for asynchronous stream processing with non-blocking back pressure.">Reactive Streams</a> <em>onError</em> event. Stream ID MUST be &gt; 0.</td></tr><tr><td align="left"><strong>REJECTED</strong></td><td align="left">0x00000202</td><td align="left">Despite being a valid request, the Responder decided to reject it. The Responder guarantees that it didn&#x27;t process the request. The reason for the rejection is explained in the Error Data section. Stream ID MUST be &gt; 0.</td></tr><tr><td align="left"><strong>CANCELED</strong></td><td align="left">0x00000203</td><td align="left">The Responder canceled the request but may have started processing it (similar to REJECTED but doesn&#x27;t guarantee lack of side-effects). Stream ID MUST be &gt; 0.</td></tr><tr><td align="left"><strong>INVALID</strong></td><td align="left">0x00000204</td><td align="left">The request is invalid. Stream ID MUST be &gt; 0.</td></tr><tr><td align="left"><strong>RESERVED</strong></td><td align="left">0xFFFFFFFF</td><td align="left"><strong>Reserved for Extension Use</strong></td></tr></tbody></table><p><strong>NOTE</strong>: Unsed values in the range of 0x0001 to 0x00300 are reserved for future protocol use. Values in the range of 0x00301 to 0xFFFFFFFE are reserved for application layer errors.</p><p>When this document refers to a specific Error Code as a frame, it uses this pattern: ERROR[error_code] or ERROR[error_code|error_code]</p><p>For example:</p><ul><li>ERROR[INVALID_SETUP] means the ERROR frame with the INVALID_SETUP code</li><li>ERROR[REJECTED] means the ERROR frame with the REJECTED code</li><li>ERROR[CONNECTION_ERROR|REJECTED_RESUME] means the ERROR frame with either the CONNECTION_ERROR or REJECTED_RESUME code</li></ul><a name="frame-lease"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lease-frame-0x02"></a>LEASE Frame (0x02)<a class="hash-link" href="#lease-frame-0x02" title="Direct link to heading">#</a></h3><p>Lease frames MAY be sent by the client-side or server-side Responders and inform the
Requester that it may send Requests for a period of time and how many it may send during that duration.
See <a href="#lease-semantics">Lease Semantics</a> for more information.</p><p>The last received LEASE frame overrides all previous LEASE frame values.</p><p>Lease frames MUST always use Stream ID 0 as they pertain to the Connection.</p><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                         Stream ID = 0                         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|     Flags     |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                       Time-To-Live                          |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                     Number of Requests                      |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                            Metadata</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x02</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata present</li></ul></li><li><strong>Time-To-Live (TTL)</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer of Time (in milliseconds) for validity of LEASE from time of reception. Value MUST be &gt; 0.</li><li><strong>Number of Requests</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer of Number of Requests that may be sent until next LEASE. Value MUST be &gt; 0.</li></ul><p>A Responder implementation MAY stop all further requests by sending a LEASE with a value of 0 for <strong>Number of Requests</strong> or <strong>Time-To-Live</strong>.</p><p>When a LEASE expires due to time, the value of the <strong>Number of Requests</strong> that a Requester may make is implicitly 0.</p><p>This frame only supports Metadata, so the Metadata Length header MUST NOT be included, even if the (M)etadata flag is set true.</p><a name="frame-keepalive"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="keepalive-frame-0x03"></a>KEEPALIVE Frame (0x03)<a class="hash-link" href="#keepalive-frame-0x03" title="Direct link to heading">#</a></h3><p>KEEPALIVE frames MUST always use Stream ID 0 as they pertain to the Connection.</p><p>KEEPALIVE frames MUST be initiated by the client and sent periodically with the (<strong>R</strong>)espond flag set.</p><p>KEEPALIVE frames MAY be initiated by the server and sent upon application request with the (<strong>R</strong>)espond flag set.</p><p>Reception of a KEEPALIVE frame with the (<strong>R</strong>)espond flag set MUST cause a client or server to send
back a KEEPALIVE with the (<strong>R</strong>)espond flag <strong>NOT</strong> set. The data in the received KEEPALIVE MUST be
echoed back in the generated KEEPALIVE.</p><p>Reception of a KEEPALIVE by a server indicates to the server that the client is alive.</p><p>Reception of a KEEPALIVE by a client indicates to the client that the server is alive.</p><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                         Stream ID = 0                         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|0|R|    Flags    |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                  Last Received Position                     |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+                                                               +</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                                                               |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                              Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x03</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>R</strong>)espond with KEEPALIVE or not</li></ul></li><li><strong>Last Received Position</strong>: (63 bits = max value 2^63-1) Unsigned 63-bit long of Resume Last Received Position. Value MUST be &gt; 0. (optional. Set to all 0s when not supported.)</li><li><strong>Data</strong>: Data attached to a KEEPALIVE.</li></ul><a name="frame-request-response"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request_response-frame-0x04"></a>REQUEST_RESPONSE Frame (0x04)<a class="hash-link" href="#request_response-frame-0x04" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|F|     Flags   |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                     Metadata &amp; Request Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x04</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata present</li><li>(<strong>F</strong>)ollows: More fragments follow this fragment.</li></ul></li><li><strong>Request Data</strong>: identification of the service being requested along with parameters for the request.</li></ul><a name="frame-fnf"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request_fnf-fire-n-forget-frame-0x05"></a>REQUEST_FNF (Fire-n-Forget) Frame (0x05)<a class="hash-link" href="#request_fnf-fire-n-forget-frame-0x05" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|F|    Flags    |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                      Metadata &amp; Request Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x05</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata present</li><li>(<strong>F</strong>)ollows: More fragments follow this fragment.</li></ul></li><li><strong>Request Data</strong>: identification of the service being requested along with parameters for the request.</li></ul><a name="frame-request-stream"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request_stream-frame-0x06"></a>REQUEST_STREAM Frame (0x06)<a class="hash-link" href="#request_stream-frame-0x06" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|F|    Flags    |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                    Initial Request N                        |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                      Metadata &amp; Request Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x06</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata present</li><li>(<strong>F</strong>)ollows: More fragments follow this fragment.</li></ul></li><li><strong>Initial Request N</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer representing the initial number of items to request. Value MUST be &gt; 0.</li><li><strong>Request Data</strong>: identification of the service being requested along with parameters for the request.</li></ul><p>See <a href="#flow-control-reactive-streams">Flow Control: Reactive Streams Semantics</a> for more information on RequestN behavior.</p><a name="frame-request-channel"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request_channel-frame-0x07"></a>REQUEST_CHANNEL Frame (0x07)<a class="hash-link" href="#request_channel-frame-0x07" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-+-----------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|F|C|  Flags    |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                    Initial Request N                        |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                       Metadata &amp; Request Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x07</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata present</li><li>(<strong>F</strong>)ollows: More fragments follow this fragment.</li><li>(<strong>C</strong>)omplete: bit to indicate stream completion.</li><li>If set, <code>onComplete()</code> or equivalent will be invoked on Subscriber/Observer.</li></ul></li><li><strong>Initial Request N</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer representing the initial request N value for channel. Value MUST be &gt; 0.</li><li><strong>Request Data</strong>: identification of the service being requested along with parameters for the request.</li></ul><p>A requester MUST send only <strong>one</strong> REQUEST_CHANNEL frame. Subsequent messages from requester to responder MUST be sent as PAYLOAD frames.</p><p>A requester MUST <strong>not</strong> send PAYLOAD frames after the REQUEST_CHANNEL frame until the responder sends a REQUEST_N frame granting credits for number of PAYLOADs able to be sent.</p><p>See <a href="#flow-control-reactive-streams">Flow Control: Reactive Streams Semantics</a> for more information on RequestN behavior.</p><a name="frame-request-n"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request_n-frame-0x08"></a>REQUEST_N Frame (0x08)<a class="hash-link" href="#request_n-frame-0x08" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|0|     Flags     |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                         Request N                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x08</li><li><strong>Request N</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer representing the number of items to request. Value MUST be &gt; 0.</li></ul><p>See <a href="#flow-control-reactive-streams">Flow Control: Reactive Streams Semantics</a> for more information on RequestN behavior.</p><a name="frame-cancel"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cancel-frame-0x09"></a>CANCEL Frame (0x09)<a class="hash-link" href="#cancel-frame-0x09" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|0|    Flags      |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x09</li></ul><a name="frame-payload"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="payload-frame-0x0a"></a>PAYLOAD Frame (0x0A)<a class="hash-link" href="#payload-frame-0x0a" title="Direct link to heading">#</a></h3><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+-+-+-+---------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|M|F|C|N|  Flags  |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                     Metadata &amp; Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x0A</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>M</strong>)etadata: Metadata Present.</li><li>(<strong>F</strong>)ollows: More fragments follow this fragment.</li><li>(<strong>C</strong>)omplete: bit to indicate stream completion.<ul><li>If set, <code>onComplete()</code> or equivalent will be invoked on Subscriber/Observer.</li></ul></li><li>(<strong>N</strong>)ext: bit to indicate Next (Payload Data and/or Metadata present).<ul><li>If set, <code>onNext(Payload)</code> or equivalent will be invoked on Subscriber/Observer.</li></ul></li></ul></li><li><strong>Payload Data</strong>: payload for <a href="http://www.reactive-streams.org" target="_blank" rel="noopener noreferrer" title="Reactive Streams is an initiative to provide a standard for asynchronous stream processing with non-blocking back pressure.">Reactive Streams</a> onNext.</li></ul><p>Valid combinations of (C)omplete and (N)ext flags are:</p><ul><li>Both (C)omplete and (N)ext set meaning PAYLOAD contains data and signals stream completion.<ul><li>For example: An Observable stream receiving <code>onNext(payload)</code> followed by <code>onComplete()</code>.</li></ul></li><li>Just (C)omplete set meaning PAYLOAD contains no data and only signals stream completion.<ul><li>For example: An Observable stream receiving <code>onComplete()</code>.</li></ul></li><li>Just (N)ext set meaning PAYLOAD contains data stream is NOT completed.<ul><li>For example: An Observable stream receiving <code>onNext(payload)</code>.</li></ul></li></ul><p>A PAYLOAD MUST NOT have both (C)complete and (N)ext empty (false).</p><p>The reason for the (N)ext flag instead of just deriving from Data length being &gt; 0 is that 0 length data can be considered a valid PAYLOAD resulting in a delivery to the application layer with a PAYLOAD containing 0 bytes of data.</p><p>For example: An Observable stream receiving data via <code>onNext(payload)</code> where payload contains 0 bytes of data.</p><a name="frame-metadata-push"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="metadata_push-frame-0x0c"></a>METADATA_PUSH Frame (0x0C)<a class="hash-link" href="#metadata_push-frame-0x0c" title="Direct link to heading">#</a></h3><p>A Metadata Push frame can be used to send asynchronous metadata notifications from a Requester or
Responder to its peer.</p><p>METADATA_PUSH frames MUST always use Stream ID 0 as they pertain to the Connection.</p><p>Metadata tied to a particular stream uses the individual Payload frame Metadata flag.</p><p>Frame Contents</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                         Stream ID = 0                         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|1|     Flags     |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                            Metadata</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x0C</li></ul><p>This frame only supports Metadata, so the Metadata Length header MUST NOT be included.</p><a name="frame-ext"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ext-extension-frame-0x3f"></a>EXT (Extension) Frame (0x3F)<a class="hash-link" href="#ext-extension-frame-0x3f" title="Direct link to heading">#</a></h3><p>The general format for an extension frame is given below.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                           Stream ID                           |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |I|M|    Flags      |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                      Extended Type                          |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">                      Depends on Extended Type...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x3F</li><li><strong>Flags</strong>: (10 bits)<ul><li>(<strong>I</strong>)gnore: Can the frame be ignored if not understood?</li><li>(<strong>M</strong>)etadata: Metadata Present.</li></ul></li><li><strong>Extended Type</strong>: (31 bits = max value 2^31-1 = 2,147,483,647) Unsigned 31-bit integer of Extended type information. Value MUST be &gt; 0.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="resuming-operation"></a>Resuming Operation<a class="hash-link" href="#resuming-operation" title="Direct link to heading">#</a></h2><p>Due to the large number of active requests for RSocket, it is often necessary to provide the ability for resuming operation on transport failure. This behavior is totally optional for operation and may be supported or not based on an implementation choice.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="assumptions"></a>Assumptions<a class="hash-link" href="#assumptions" title="Direct link to heading">#</a></h3><p>RSocket resumption exists only for specific cases. It is not intended to be an “always works” solution. If resuming operation is not possible, the connection should be terminated with an ERROR as specified by the protocol definition.</p><ol><li>Resumption is optional behavior for implementations. But highly suggested. Clients and Servers should assume NO resumption capability by default.</li><li>Resumption is an optimistic operation. It may not always succeed.</li><li>Resumption is desired to be fast and require a minimum of state to be exchanged.</li><li>Resumption is designed for loss of connectivity and assumes client and server state is maintained across connectivity loss. I.e. there is no assumption of loss of state by either end. This is very important as without it, all the requirements of &quot;guaranteed messaging&quot; come into play.</li><li>Resumption assumes no changes to Lease, Data format (encoding), etc. for resuming operation. i.e. A client is not allowed to change the metadata MIME type or the data MIME type or version, etc. when resuming operation.</li><li>Resumption is always initiated by the client and either allowed or denied by the server.</li><li>Resumption makes no assumptions of application state for delivered frames with respect to atomicity, transactionality, etc. See above.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="implied-position"></a>Implied Position<a class="hash-link" href="#implied-position" title="Direct link to heading">#</a></h3><p>Resuming operation requires knowing the position of data reception of the previous connection. For this to be simplified, the underlying transport is assumed to support contiguous delivery of data on a per frame basis. In other words, partial frames are not delivered for processing nor are gaps allowed in the stream of frames sent by either the client or server. The current list of supported transports (TCP, WebSocket, and <a href="https://github.com/real-logic/Aeron" target="_blank" rel="noopener noreferrer" title="Efficient reliable UDP unicast, UDP multicast, and IPC message transport.">Aeron</a>) all satisfy this requirement or can be made to do so in the case of TCP.</p><p>As a Requester or Responder <strong>sends</strong> REQUEST, CANCEL, or PAYLOAD frames, it maintains a <strong>position</strong> of that frame within the connection in that direction. This is a 64-bit value that starts at 0. As a Requester or Responder <strong>receives</strong> REQUEST, CANCEL, or PAYLOAD frames, it maintains an <strong>implied position</strong> of that frame within the connection in that direction. This is also a 64-bit value that starts at 0.</p><p>The reason this is “implied” is that the position is not included in each frame and is inferred simply by the message being sent/received on the connection in relation to previous frames.</p><p>This position will be used to identify the location for resuming operation to begin.</p><p>Frame types outside REQUEST, CANCEL, ERROR, and PAYLOAD do not have assigned (nor implied) positions.</p><p>When a client sends a RESUME frame, it sends two implied positions: the last frame that was received from the server; the earliest frame position it still retains. The server can make a determination on whether resumption is possible: have all frames past the client&#x27;s last-received position been retained? and has the client retained all frames past the server&#x27;s last-retained position. If resumption is allowed to continue, the server sends a RESUME_OK frame, indicating its last-received position.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="client-lifetime-management"></a>Client Lifetime Management<a class="hash-link" href="#client-lifetime-management" title="Direct link to heading">#</a></h3><p>Client lifetime management for servers MUST be extended to incorporate the length of time a client may successfully attempt resumption passed a transport disconnect. The means of client lifetime management are totally up to the implementation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="resume-operation"></a>Resume Operation<a class="hash-link" href="#resume-operation" title="Direct link to heading">#</a></h3><p>All ERROR frames sent MUST be CONNECTION_ERROR or REJECTED_RESUME error code.</p><p>Client side resumption operation starts when the client desires to try to resume and starts a new transport connection. The operation then proceeds as the following:</p><ul><li>Client sends RESUME frame. The client MUST NOT send any other frame types until resumption succeeds. The RESUME Identification Token MUST be the token used in the original SETUP frame. The RESUME Last Received Position field MUST be the last successfully received implied position from the server.</li><li>Client waits for either a RESUME_OK or ERROR[CONNECTION_ERROR|REJECTED_RESUME] frame from the server.</li><li>On receiving an ERROR[REJECTED_RESUME] frame, the client MUST NOT attempt resumption again.</li><li>On receiving a RESUME_OK, the client:<ul><li>MUST assume that the next REQUEST, CANCEL, ERROR, and PAYLOAD frames have an implied position commencing from the last implied positions</li><li>MAY retransmit <em>all</em> REQUEST, CANCEL, ERROR, and PAYLOAD frames starting at the RESUME_OK Last Received Position field value from the server.</li><li>MAY send an ERROR[CONNECTION_ERROR|CONNECTION_CLOSE] frame indicating the end of the connection and MUST NOT attempt resumption again</li></ul></li></ul><p>Server side resumption operation starts when the client sends a RESUME frame. The operation then proceeds as the following:</p><ul><li>On receiving a RESUME frame, the server:<ul><li>MUST send an ERROR[REJECTED_RESUME] frame if the server does not support resuming operation.</li><li>use the RESUME Identification Token field to determine which client the resume pertains to. If the client is identified successfully, resumption MAY be continued. If not identified, then the server MUST send an ERROR[REJECTED_RESUME] frame.</li><li>if successfully identified, then the server MAY send a RESUME_OK and then:<ul><li>MUST assume that the next REQUEST, CANCEL, ERROR, and PAYLOAD frames have an implied position commencing from the last implied positions</li><li>MAY retransmit <em>all</em> REQUEST, CANCEL, ERROR, and PAYLOAD frames starting at the RESUME Last Received Position field value from the client.</li></ul></li><li>if successfully identified, then the server MAY send an ERROR[REJECTED_RESUME] frame if the server can not resume operation given the value of RESUME Last Received Position if the position is not one it deems valid to resume operation from or other extenuating circumstances.</li></ul></li></ul><p>A Server that receives a RESUME frame after a SETUP frame, SHOULD send an ERROR[CONNECTION_ERROR].</p><p>A Server that receives a RESUME frame after a previous RESUME frame, SHOULD send an ERROR[CONNECTION_ERROR].</p><p>Leasing semantics are NOT assumed to carry over from previous connections when resuming. LEASE semantics MUST be restarted upon a new connection by sending a LEASE frame from the server.</p><a name="frame-resume"></a><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="resume-frame-0x0d"></a>RESUME Frame (0x0D)<a class="hash-link" href="#resume-frame-0x0d" title="Direct link to heading">#</a></h4><p>The general format for a Resume frame is given below.</p><p>RESUME frames MUST always use Stream ID 0 as they pertain to the connection.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                         Stream ID = 0                         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|0|    Flags      |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|        Major Version          |         Minor Version         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|         Token Length          | Resume Identification Token  ...</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                                                             |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+                 Last Received Server Position                 +</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                                                               |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                                                             |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+                First Available Client Position                +</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                                                               |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x0D</li><li><strong>Major Version</strong>: (16 bits = max value 65,535) Unsigned 16-bit integer of Major version number of the protocol.</li><li><strong>Minor Version</strong>: (16 bits = max value 65,535) Unsigned 16-bit integer of Minor version number of the protocol.</li><li><strong>Resume Identification Token Length</strong>: (16 bits = max value 65,535) Unsigned 16-bit integer of Resume Identification Token Length in bytes.</li><li><strong>Resume Identification Token</strong>: Token used for client resume identification. Same Resume Identification used in the initial SETUP by the client.</li><li><strong>Last Received Server Position</strong>: (63 bits = max value 2^63-1) Unsigned 63-bit long of the last implied position the client received from the server.</li><li><strong>First Available Client Position</strong>: (63 bits = max value 2^63-1) Unsigned 63-bit long of the earliest position that the client can rewind back to prior to resending frames.</li></ul><a name="frame-resume-ok"></a><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="resume_ok-frame-0x0e"></a>RESUME_OK Frame (0x0E)<a class="hash-link" href="#resume_ok-frame-0x0e" title="Direct link to heading">#</a></h4><p>The general format for a Resume OK frame is given below.</p><p>RESUME OK frames MUST always use Stream ID 0 as they pertain to the connection.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-asciidoc codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0                   1                   2                   3</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                         Stream ID = 0                         |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-----------+-+-+---------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|Frame Type |0|0|    Flags      |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+-------------------------------+</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|0|                                                             |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+               Last Received Client Position                   +</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">|                                                               |</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ul><li><strong>Frame Type</strong>: (6 bits) 0x0E</li><li><strong>Last Received Client Position</strong>: (63 bits = max value 2^63-1) Unsigned 63-bit long of the last implied position the server received from the client.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="keepalive-position-field"></a>Keepalive Position Field<a class="hash-link" href="#keepalive-position-field" title="Direct link to heading">#</a></h4><p>Keepalive frames include the implied position of the client (or server). When sent, they act as a means for the other end of the connection to know the position of the other side.</p><p>This information MAY be used to update state for possible retransmission, such as trimming a retransmit buffer, or possible associations with individual stream status.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="identification-token-handling"></a>Identification Token Handling<a class="hash-link" href="#identification-token-handling" title="Direct link to heading">#</a></h3><p>The requirements for the Resume Identification Token are implementation dependent. However, some guidelines and considerations are:</p><ul><li>Tokens may be generated by the client.</li><li>Tokens may be generated outside the client and the server and managed externally to the protocol.</li><li>Tokens should uniquely identify a connection on the server. The server should not assume a generation method of the token and should consider the token opaque. This allows a client to be compatible with any RSocket implementation that supports resuming operation and allows the client full control of Identification Token generation.</li><li>Tokens MUST be valid for the lifetime of an individual RSocket including possible resumption.</li><li>A server should not accept a SETUP with a Token that is currently already being used</li><li>Tokens should be resilient to replay attacks and thus should only be valid for the lifetime of an individual connection</li><li>Tokens should not be predictable by an attacking 3rd party</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="connection-establishment"></a>Connection Establishment<a class="hash-link" href="#connection-establishment" title="Direct link to heading">#</a></h2><p><strong>NOTE</strong>: The semantics are similar to <a href="https://tools.ietf.org/html/draft-bmoeller-tls-falsestart-00" target="_blank" rel="noopener noreferrer">TLS False Start</a>.</p><p>Immediately upon successful connection, the client MUST send either a SETUP or RESUME frame with
Stream ID of 0. Any other frame received that is NOT a SETUP|RESUME frame or a SETUP|RESUME frame with
a Stream ID &gt; 0, MUST cause the server to send an ERROR[INVALID_SETUP] and close the connection.</p><p>See <a href="#resume-operation">Resume Operation</a> for more information about resuming. The rest of this section assumes use of SETUP for establishing a connection.</p><p>The client-side Requester can inform the server-side Responder as to whether it will
honor LEASEs or not based on the presence of the <strong>L</strong> flag in the SETUP frame.</p><p>The client-side Requester that has NOT set the <strong>L</strong> flag in the SETUP frame may send
requests immediately if it so desires without waiting for a LEASE from the server.</p><p>The client-side Requester that has set the <strong>L</strong> flag in the SETUP frame MUST wait
for the server-side Responder to send a LEASE frame before it can send requests.</p><p>If the server accepts the contents of the SETUP frame, it MUST send a LEASE frame if
the SETUP frame set the <strong>L</strong> flag. The server-side Requester may send requests
immediately upon receiving a SETUP frame that it accepts if the <strong>L</strong> flag is not set in the SETUP frame.</p><p>If the server does NOT accept the contents of the SETUP frame, the server MUST send
back an ERROR[INVALID_SETUP|UNSUPPORTED_SETUP] and then close the connection.</p><p>The server-side Requester mirrors the LEASE requests of the client-side Requester. If a client-side
Requester sets the <strong>L</strong> flag in the SETUP frame, the server-side Requester MUST wait for a LEASE
frame from the client-side Responder before it can send a request. The client-side Responder MUST
send a LEASE frame after a SETUP frame with the <strong>L</strong> flag set.</p><p>A client assumes a SETUP is accepted if it receives a response to a request, a LEASE
frame, or if it sees a REQUEST type.</p><p>A client assumes a SETUP is rejected if it receives an ERROR.</p><p>Until connection establishment is complete, a Requester MUST NOT send any Request frames.</p><p>Until connection establishment is complete, a Responder MUST NOT emit any PAYLOAD frames.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="negotiation"></a>Negotiation<a class="hash-link" href="#negotiation" title="Direct link to heading">#</a></h3><p>The assumption is that the client will be dictating to the server what it desires to do. The server will decide to support
that SETUP (accept it) or not (reject it). The ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP] error code indicates the reason for the rejection.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sequences-without-lease"></a>Sequences without LEASE<a class="hash-link" href="#sequences-without-lease" title="Direct link to heading">#</a></h3><p>The possible sequences without LEASE are below.</p><ol><li>Client-side Request, Server-side <strong>accepts</strong> SETUP<ul><li>Client connects &amp; sends SETUP &amp; sends REQUEST</li><li>Server accepts SETUP, handles REQUEST, sends back normal sequence based on REQUEST type</li></ul></li><li>Client-side Request, Server-side <strong>rejects</strong> SETUP<ul><li>Client connects &amp; sends SETUP &amp; sends REQUEST</li><li>Server rejects SETUP, sends back ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP], closes connection</li></ul></li><li>Server-side Request, Server-side <strong>accepts</strong> SETUP<ul><li>Client connects &amp; sends SETUP</li><li>Server accepts SETUP, sends back REQUEST type</li></ul></li><li>Server-side Request, Server-side <strong>rejects</strong> SETUP<ul><li>Client connects &amp; sends SETUP</li><li>Server rejects SETUP, sends back ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP], closes connection</li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sequences-with-lease"></a>Sequences with LEASE<a class="hash-link" href="#sequences-with-lease" title="Direct link to heading">#</a></h3><p>The possible sequences with LEASE are below.</p><ol><li>Client-side Request, Server-side <strong>accepts</strong> SETUP<ul><li>Client connects &amp; sends SETUP with <strong>L</strong> flag</li><li>Server accepts SETUP, sends back LEASE frame</li><li>Client-side sends REQUEST</li></ul></li><li>Client-side Request, Server-side <strong>rejects</strong> SETUP<ul><li>Client connects &amp; sends SETUP with <strong>L</strong> flag</li><li>Server rejects SETUP, sends back ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP], closes connection</li></ul></li><li>Server-side Request, Server-side <strong>accepts</strong> SETUP<ul><li>Client connects &amp; sends SETUP with <strong>L</strong> flag</li><li>Server accepts SETUP, sends back LEASE frame</li><li>Client sends LEASE frame</li><li>Server sends REQUEST</li></ul></li><li>Server-side Request, Server-side <strong>rejects</strong> SETUP<ul><li>Client connects &amp; sends SETUP with <strong>L</strong> flag</li><li>Server rejects SETUP, sends back ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP], closes connection</li></ul></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fragmentation-and-reassembly"></a>Fragmentation And Reassembly<a class="hash-link" href="#fragmentation-and-reassembly" title="Direct link to heading">#</a></h2><p>PAYLOAD frames and all REQUEST frames may represent a large object and MAY need to be fragmented to fit within the Frame Data size. When this occurs, the <strong>F</strong> flag indicates if more fragments follow the current frame (or not).</p><p>Fragmentation does not change the request(n) or lease counts. In other words, a fragmented PAYLOAD frame counts as a single request(n) credit, and a request counts against a single lease count, regardless of how many fragments the frame is split into.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="payload-frame"></a>PAYLOAD Frame<a class="hash-link" href="#payload-frame" title="Direct link to heading">#</a></h4><p>When a PAYLOAD frame needs to be fragmented, a sequence of PAYLOAD frames is delivered using the (F)ollows flag.</p><p>When a PAYLOAD is fragmented, the Metadata MUST be transmitted completely before the Data.</p><p>For example, a single PAYLOAD with 20MB of Metadata and 25MB of Data that is fragmented into 3 frames:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">-- PAYLOAD frame </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Frame length </span><span class="token operator">=</span><span class="token plain"> 16MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">etadata present </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">ollows </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fragments coming</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata Length </span><span class="token operator">=</span><span class="token plain"> 16MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">16MB of METADATA</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">0MB of Data</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">-- PAYLOAD frame </span><span class="token number">2</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Frame length </span><span class="token operator">=</span><span class="token plain"> 16MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">etadata present </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">ollows </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fragments coming</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata Length </span><span class="token operator">=</span><span class="token plain"> 4MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">4MB of METADATA</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">12MB of Data</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">-- PAYLOAD frame </span><span class="token number">3</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Frame length </span><span class="token operator">=</span><span class="token plain"> 13MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">etadata present </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">ollows </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">0MB of METADATA</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">13MB of Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If the sender (Requester or Responder) wants to cancel sending a fragmented sequence, it MAY send a CANCEL frame without finishing delivery of the fragments.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-frames"></a>REQUEST Frames<a class="hash-link" href="#request-frames" title="Direct link to heading">#</a></h4><p>When REQUEST<em>RESPONSE, REQUEST_FNF, REQUEST_STREAM, or REQUEST_CHANNEL frames need to be fragmented, the first frame is the REQUEST</em>* frame with the (F)ollows flag set, followed by a sequence of PAYLOAD frames.</p><p>When fragmented, the Metadata MUST be transmitted completely before the Data.</p><p>For example, a single PAYLOAD with 20MB of Metadata and 25MB of Data that is fragmented into 3 frames:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">-- REQUEST_RESPONSE frame </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Frame length </span><span class="token operator">=</span><span class="token plain"> 16MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">etadata present </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">ollows </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fragments coming</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata Length </span><span class="token operator">=</span><span class="token plain"> 16MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">16MB of METADATA</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">0MB of Data</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">-- PAYLOAD frame </span><span class="token number">2</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Frame length </span><span class="token operator">=</span><span class="token plain"> 16MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">etadata present </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">ollows </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fragments coming</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Metadata Length </span><span class="token operator">=</span><span class="token plain"> 4MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">4MB of METADATA</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">12MB of Data</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">-- PAYLOAD frame </span><span class="token number">3</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Frame length </span><span class="token operator">=</span><span class="token plain"> 13MB</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">etadata present </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">F</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">ollows </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">0MB of METADATA</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">13MB of Data</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If the Requester wants to cancel sending a fragmented sequence, it MAY send a CANCEL frame without finishing delivery of the fragments.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="stream-sequences-and-lifetimes"></a>Stream Sequences and Lifetimes<a class="hash-link" href="#stream-sequences-and-lifetimes" title="Direct link to heading">#</a></h2><p>Streams exists for a specific period of time. So an implementation may assume that Stream IDs are valid for a finite period of time. This period of time is bound by either a) the lifetime of the underlying transport protocol connection, or b) the lifetime of a session if resumability is used to extend the session across multiple transport protocol connections. Beyond that, each interaction pattern imposes lifetime based on a sequence of interactions between Requester and Responder.</p><p>In the section below, &quot;RQ -&gt; RS&quot; refers to Requester sending a frame to a Responder. And &quot;RS -&gt; RQ&quot; refers to Responder sending
a frame to a Requester.</p><p>In the section below, &quot;*&quot; refers to 0 or more and &quot;+&quot; refers to 1 or more.</p><p>Once a stream has &quot;terminated&quot;, the Stream ID can be &quot;forgotten&quot; by the Requester and Responder, but the Stream ID MUST NOT be re-used. See <a href="#stream-identifiers">Stream Identifier</a> for more information.</p><a name="stream-sequences-request-response"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-response"></a>Request Response<a class="hash-link" href="#request-response" title="Direct link to heading">#</a></h3><ol><li>RQ -&gt; RS: REQUEST_RESPONSE</li><li>RS -&gt; RQ: PAYLOAD with COMPLETE</li></ol><p>or</p><ol><li>RQ -&gt; RS: REQUEST_RESPONSE</li><li>RS -&gt; RQ: ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID]</li></ol><p>or</p><ol><li>RQ -&gt; RS: REQUEST_RESPONSE</li><li>RQ -&gt; RS: CANCEL</li></ol><p>Upon sending a response, the stream is terminated on the Responder.</p><p>Upon receiving a CANCEL, the stream is terminated on the Responder and the response SHOULD not be sent.</p><p>Upon sending a CANCEL, the stream is terminated on the Requester.</p><p>Upon receiving a COMPLETE or ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID], the stream is terminated on the Requester.</p><a name="stream-sequences-fire-and-forget"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-fire-n-forget"></a>Request Fire-n-Forget<a class="hash-link" href="#request-fire-n-forget" title="Direct link to heading">#</a></h3><ol><li>RQ -&gt; RS: REQUEST_FNF</li></ol><p>Upon reception, the stream is terminated by the Responder.</p><p>Upon being sent, the stream is terminated by the Requester.</p><p>REQUEST_FNF are assumed to be best effort and MAY not be processed due to: (1) SETUP rejection, (2) mis-formatting, (3) etc.</p><a name="stream-sequences-request-stream"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-stream"></a>Request Stream<a class="hash-link" href="#request-stream" title="Direct link to heading">#</a></h3><ol><li>RQ -&gt; RS: REQUEST_STREAM</li><li>RS -&gt; RQ: PAYLOAD*</li><li>RS -&gt; RQ: ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID]</li></ol><p>or</p><ol><li>RQ -&gt; RS: REQUEST_STREAM</li><li>RS -&gt; RQ: PAYLOAD*</li><li>RS -&gt; RQ: COMPLETE</li></ol><p>or</p><ol><li>RQ -&gt; RS: REQUEST_STREAM</li><li>RS -&gt; RQ: PAYLOAD*</li><li>RQ -&gt; RS: CANCEL</li></ol><p>At any time, the Requester may send REQUEST_N frames.</p><p>Upon receiving a CANCEL, the stream is terminated on the Responder.</p><p>Upon sending a CANCEL, the stream is terminated on the Requester.</p><p>Upon receiving a COMPLETE or ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID], the stream is terminated on the Requester.</p><p>Upon sending a COMPLETE or ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID], the stream is terminated on the Responder.</p><a name="stream-sequences-channel"></a><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-channel"></a>Request Channel<a class="hash-link" href="#request-channel" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="complete-from-requester-and-responder"></a>COMPLETE from Requester and Responder<a class="hash-link" href="#complete-from-requester-and-responder" title="Direct link to heading">#</a></h4><ol><li>RQ -&gt; RS: REQUEST_CHANNEL</li><li>RQ -&gt; RS: PAYLOAD*</li><li>RQ -&gt; RS: COMPLETE</li></ol><p>intermixed with</p><ol><li>RS -&gt; RQ: PAYLOAD*</li><li>RS -&gt; RQ: COMPLETE</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="error-from-requester-responder-terminates"></a>Error from Requester, Responder terminates<a class="hash-link" href="#error-from-requester-responder-terminates" title="Direct link to heading">#</a></h4><ol><li>RQ -&gt; RS: REQUEST_CHANNEL</li><li>RQ -&gt; RS: PAYLOAD*</li><li>RQ -&gt; RS: ERROR[APPLICATION_ERROR]</li></ol><p>intermixed with</p><ol><li>RS -&gt; RQ: PAYLOAD*</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="error-from-requester-responder-already-completed"></a>Error from Requester, Responder already Completed<a class="hash-link" href="#error-from-requester-responder-already-completed" title="Direct link to heading">#</a></h4><ol><li>RQ -&gt; RS: REQUEST_CHANNEL</li><li>RQ -&gt; RS: PAYLOAD*</li><li>RQ -&gt; RS: ERROR[APPLICATION_ERROR]</li></ol><p>intermixed with</p><ol><li>RS -&gt; RQ: PAYLOAD*</li><li>RS -&gt; RQ: COMPLETE</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="error-from-responder-requester-terminates"></a>Error from Responder, Requester terminates<a class="hash-link" href="#error-from-responder-requester-terminates" title="Direct link to heading">#</a></h4><ol><li>RQ -&gt; RS: REQUEST_CHANNEL</li><li>RQ -&gt; RS: PAYLOAD*</li></ol><p>intermixed with</p><ol><li>RS -&gt; RQ: PAYLOAD*</li><li>RS -&gt; RQ: ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID]</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="error-from-responder-requester-already-completed"></a>Error from Responder, Requester already Completed<a class="hash-link" href="#error-from-responder-requester-already-completed" title="Direct link to heading">#</a></h4><ol><li>RQ -&gt; RS: REQUEST_CHANNEL</li><li>RQ -&gt; RS: PAYLOAD*</li><li>RQ -&gt; RS: COMPLETE</li></ol><p>intermixed with</p><ol><li>RS -&gt; RQ: PAYLOAD*</li><li>RS -&gt; RQ: ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID]</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cancel-from-requester-responder-terminates"></a>Cancel from Requester, Responder terminates<a class="hash-link" href="#cancel-from-requester-responder-terminates" title="Direct link to heading">#</a></h4><ol><li>RQ -&gt; RS: REQUEST_CHANNEL</li><li>RQ -&gt; RS: PAYLOAD*</li><li>RQ -&gt; RS: COMPLETE</li><li>RQ -&gt; RS: CANCEL</li></ol><p>intermixed with</p><ol><li>RS -&gt; RQ: PAYLOAD*</li></ol><p>At any time, a Requester may send PAYLOAD frames.</p><p>At any time, a Requester, as well as a Responder, may send REQUEST_N frames.</p><p>An implementation MUST only send a single initial REQUEST_CHANNEL frame from the Requester to the Responder. And
a Responder MUST respond to an initial REQUEST_CHANNEL frame with a REQUEST_N frame.</p><p>Upon receiving a CANCEL, the stream is terminated on the Responder.</p><p>Upon sending a CANCEL, the stream is terminated on the Requester.</p><p>Upon receiving an ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID], the stream is terminated on both Requester and Responder.</p><p>Upon sending an ERROR[APPLICATION_ERROR|REJECTED|CANCELED|INVALID], the stream is terminated on both the Requester and Responder.</p><p>In absence of ERROR or CANCEL, the stream is terminated after both Requester and Responder have sent and received COMPLETE.</p><p>A Requester may indicate COMPLETE by setting the C bit on either the initial REQUEST_CHANNEL frame, or on the last PAYLOAD frame sent. A Requester MUST NOT send any additional PAYLOAD frames after sending a frame with the C bit set.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="flow-control"></a>Flow Control<a class="hash-link" href="#flow-control" title="Direct link to heading">#</a></h3><p>There are multiple flow control mechanics provided by the protocol.</p><a name="flow-control-reactive-streams"></a><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="reactive-streams-semantics"></a>Reactive Streams Semantics<a class="hash-link" href="#reactive-streams-semantics" title="Direct link to heading">#</a></h4><p><a href="http://www.reactive-streams.org" target="_blank" rel="noopener noreferrer" title="Reactive Streams is an initiative to provide a standard for asynchronous stream processing with non-blocking back pressure.">Reactive Streams</a> semantics are used for flow control of Streams, Subscriptions, and Channels. This is a credit-based model where the Requester grants the Responder credit for the number of PAYLOADs it can send. It is sometimes referred to as &quot;request-n&quot; or &quot;request(n)&quot;.</p><p>Credits are cumulative. Once credits are granted from Requester to Responder, they cannot be revoked. For example, sending <code>request(3)</code> and <code>request(2)</code> accumulates to a value of 5, allowing the Responder to send 5 PAYLOADs.</p><p>Please note that this explicitly does NOT follow rule number 17 in <a href="https://github.com/reactive-streams/reactive-streams-jvm/blob/v1.0.0/README.md#3-subscription-code" target="_blank" rel="noopener noreferrer">https://github.com/reactive-streams/reactive-streams-jvm/blob/v1.0.0/README.md#3-subscription-code</a></p><p>While Reactive Streams support a demand of up to 2^63-1, and treats 2^63-1 as a magic number signaling to not track demand, this is not the case for RSocket. RSocket prioritizes byte size and only uses 4 bytes instead of 8 so the magic number is unavailable.</p><p>The Requester and the Responder MUST respect the Reactive Streams semantics.</p><p>e.g. here&#x27;s an example of a successful stream call with flow-control.</p><ol><li>RQ -&gt; RS: REQUEST_STREAM (REQUEST_N=3)</li><li>RS -&gt; RQ: PAYLOAD</li><li>RS -&gt; RQ: PAYLOAD</li><li>RS -&gt; RQ: PAYLOAD</li><li>RS needs to wait for a new REQUEST_N at that point</li><li>RQ -&gt; RS: REQUEST_N (N=3)</li><li>RS -&gt; RQ: PAYLOAD</li><li>RS -&gt; RQ: PAYLOAD with COMPLETE</li></ol><a name="flow-control-lease"></a><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lease-semantics"></a>Lease Semantics<a class="hash-link" href="#lease-semantics" title="Direct link to heading">#</a></h4><p>The LEASE semantics are to control the number of individual requests (all types) that a Requester may send in a given period.
The only responsibility the protocol implementation has for the LEASE is to honor it on the Requester side. The Responder application
is responsible for the logic of generation and informing the Responder it should send a LEASE to the peer Requester.</p><p>Requester MUST respect the LEASE contract. The Requester MUST NOT send more than <strong>Number of Requests</strong> specified
in the LEASE frame within the <strong>Time-To-Live</strong> value in the LEASE.</p><p>A Responder that receives a REQUEST that it can not honor due to LEASE restrictions MUST respond with an ERROR[REJECTED]. This includes an initial LEASE sent as part of <a href="#connection-establishment">Connection Establishment</a>.</p><a name="flow-control-qos"></a><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="qos-and-prioritization"></a>QoS and Prioritization<a class="hash-link" href="#qos-and-prioritization" title="Direct link to heading">#</a></h4><p>Quality of Service and Prioritization of streams are considered application or network layer concerns and are better dealt with
at those layers. The metadata capabilities, including METADATA_PUSH, are tools that applications can use for effective prioritization.
DiffServ via IP QoS are best handled by the underlying network layer protocols.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="handling-the-unexpected"></a>Handling the Unexpected<a class="hash-link" href="#handling-the-unexpected" title="Direct link to heading">#</a></h3><p>This protocol attempts to be very lenient in processing of received frames and SHOULD ignore
conditions that do not make sense given the current context. Clarifications are given below:</p><ol><li><p>TCP half-open connections (and WebSockets) or other dead transports are detectable by lack of KEEPALIVE frames as specified under <a href="#frame-keepalive">Keepalive Frame</a>. The decision to close a connection due to inactivity is the applications choice.</p></li><li><p>Request keepalive and timeout semantics are the responsibility of the application.</p></li><li><p>Lack of REQUEST_N frames that stops a stream is an application concern and SHALL NOT be handled by the protocol.</p></li><li><p>Lack of LEASE frames that stops new Requests is an application concern and SHALL NOT be handled by the protocol.</p></li><li><p>If a PAYLOAD for a REQUEST_RESPONSE is received that does not have a COMPLETE flag set, the implementation MUST</p></li></ol><p>assume it is set and act accordingly.</p><ol><li><p>Reassembly of PAYLOADs and REQUEST_CHANNELs MUST assume the possibility of an infinite stream.</p></li><li><p>A PAYLOAD with both <strong>F</strong> and <strong>C</strong> flags set, implicitly ignores the <strong>F</strong> flag.</p></li><li><p>Flag bits not specified for a particular frame MUST be ignored.</p></li><li><p>All other received frames that are not accounted for in previous sections MUST be ignored. Thus, for example:</p><ol><li>Receiving a Request frame on a Stream ID that is already in use MUST be ignored.</li><li>Receiving a CANCEL on an unknown Stream ID (including 0) MUST be ignored.</li><li>Receiving an ERROR on an unknown Stream ID MUST be ignored.</li><li>Receiving a PAYLOAD on an unknown Stream ID (including 0) MUST be ignored.</li><li>Receiving a METADATA_PUSH with a non-0 Stream ID MUST be ignored.</li><li>A server MUST ignore a SETUP frame after it has accepted a previous SETUP.</li><li>A server MUST ignore an ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP|REJECTED_RESUME] frame.</li><li>A client MUST ignore an ERROR[INVALID_SETUP|UNSUPPORTED_SETUP|REJECTED_SETUP|REJECTED_RESUME] frame after it has completed connection establishment.</li><li>A client MUST ignore a SETUP frame.</li></ol></li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/rsocket/rsocket-website/edit/master/website-docs/../website-docs/protocol.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-01-27T13:02:39.000Z" class="docLastUpdatedAt_1Qna">1/27/2021</time> by <strong>Kevin Viglucci</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/motivations"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Motivations</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/implementations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Implementations »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#status" class="table-of-contents__link">Status</a></li><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#table-of-contents" class="table-of-contents__link">Table of Contents</a></li><li><a href="#terminology" class="table-of-contents__link">Terminology</a></li><li><a href="#versioning-scheme" class="table-of-contents__link">Versioning Scheme</a><ul><li><a href="#cross-version-compatibility" class="table-of-contents__link">Cross version compatibility</a></li></ul></li><li><a href="#data-and-metadata" class="table-of-contents__link">Data And Metadata</a></li><li><a href="#framing" class="table-of-contents__link">Framing</a><ul><li><a href="#transport-protocol" class="table-of-contents__link">Transport Protocol</a></li><li><a href="#framing-protocol-usage" class="table-of-contents__link">Framing Protocol Usage</a></li><li><a href="#framing-format" class="table-of-contents__link">Framing Format</a></li><li><a href="#frame-header-format" class="table-of-contents__link">Frame Header Format</a></li><li><a href="#stream-identifiers" class="table-of-contents__link">Stream Identifiers</a></li><li><a href="#frame-types" class="table-of-contents__link">Frame Types</a></li><li><a href="#setup-frame-0x01" class="table-of-contents__link">SETUP Frame (0x01)</a></li><li><a href="#error-frame-0x0b" class="table-of-contents__link">ERROR Frame (0x0B)</a></li><li><a href="#lease-frame-0x02" class="table-of-contents__link">LEASE Frame (0x02)</a></li><li><a href="#keepalive-frame-0x03" class="table-of-contents__link">KEEPALIVE Frame (0x03)</a></li><li><a href="#request_response-frame-0x04" class="table-of-contents__link">REQUEST_RESPONSE Frame (0x04)</a></li><li><a href="#request_fnf-fire-n-forget-frame-0x05" class="table-of-contents__link">REQUEST_FNF (Fire-n-Forget) Frame (0x05)</a></li><li><a href="#request_stream-frame-0x06" class="table-of-contents__link">REQUEST_STREAM Frame (0x06)</a></li><li><a href="#request_channel-frame-0x07" class="table-of-contents__link">REQUEST_CHANNEL Frame (0x07)</a></li><li><a href="#request_n-frame-0x08" class="table-of-contents__link">REQUEST_N Frame (0x08)</a></li><li><a href="#cancel-frame-0x09" class="table-of-contents__link">CANCEL Frame (0x09)</a></li><li><a href="#payload-frame-0x0a" class="table-of-contents__link">PAYLOAD Frame (0x0A)</a></li><li><a href="#metadata_push-frame-0x0c" class="table-of-contents__link">METADATA_PUSH Frame (0x0C)</a></li><li><a href="#ext-extension-frame-0x3f" class="table-of-contents__link">EXT (Extension) Frame (0x3F)</a></li></ul></li><li><a href="#resuming-operation" class="table-of-contents__link">Resuming Operation</a><ul><li><a href="#assumptions" class="table-of-contents__link">Assumptions</a></li><li><a href="#implied-position" class="table-of-contents__link">Implied Position</a></li><li><a href="#client-lifetime-management" class="table-of-contents__link">Client Lifetime Management</a></li><li><a href="#resume-operation" class="table-of-contents__link">Resume Operation</a></li><li><a href="#identification-token-handling" class="table-of-contents__link">Identification Token Handling</a></li></ul></li><li><a href="#connection-establishment" class="table-of-contents__link">Connection Establishment</a><ul><li><a href="#negotiation" class="table-of-contents__link">Negotiation</a></li><li><a href="#sequences-without-lease" class="table-of-contents__link">Sequences without LEASE</a></li><li><a href="#sequences-with-lease" class="table-of-contents__link">Sequences with LEASE</a></li></ul></li><li><a href="#fragmentation-and-reassembly" class="table-of-contents__link">Fragmentation And Reassembly</a></li><li><a href="#stream-sequences-and-lifetimes" class="table-of-contents__link">Stream Sequences and Lifetimes</a><ul><li><a href="#request-response" class="table-of-contents__link">Request Response</a></li><li><a href="#request-fire-n-forget" class="table-of-contents__link">Request Fire-n-Forget</a></li><li><a href="#request-stream" class="table-of-contents__link">Request Stream</a></li><li><a href="#request-channel" class="table-of-contents__link">Request Channel</a></li><li><a href="#flow-control" class="table-of-contents__link">Flow Control</a></li><li><a href="#handling-the-unexpected" class="table-of-contents__link">Handling the Unexpected</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/RSocketIO" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="RSocket Logo" src="/img/r-socket-pink.svg"></div><div class="footer__copyright">Copyright © 2021 RSocket Contributors</div></div></div></footer></div>
<script src="/styles.02122034.js"></script>
<script src="/runtime~main.3253e25a.js"></script>
<script src="/main.09032be5.js"></script>
<script src="/common.cba57560.js"></script>
<script src="/18.42db9e10.js"></script>
<script src="/19.2da7a886.js"></script>
<script src="/935f2afb.50f36023.js"></script>
<script src="/17896441.7503419a.js"></script>
<script src="/496dd638.57ae22a7.js"></script>
</body>
</html>